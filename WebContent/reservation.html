<!DOCTYPE html>
<html>
<head>
<meta name=viewport content="width=device-width, initial-scale=1, user-scalable=0">
<meta charset="UTF-8" />
<link rel="stylesheet" href="css/core.css">
<link rel="stylesheet" href="css/main.css">
<title>Fiore</title>
<style>
	.p{
	font-size:1.5em;
	font-weight:bold;
	font-family:"HY헤드라인M";
	}
	.drop .hide{display:none;}
</style>
</head>

<body>
	<div class="page-hdr"> Fiore </div>
	<div class="page-body">
	<ul class="page-mnu">
    	<li><a href="main.html">HOME</a></li>
    	<li style="background-color:lightgreen"><a href="reservation.html">꽃다발 예약</a></li>
    	<li><a href="onedayclass.html">원데이 클래스</a></li>
    	<li><a href="notice.html">공지사항</a></li>
    	<li><a href="mypage.html">마이 페이지</a></li>
    </ul>
    <div class="section pad-24 mtop-30">
  	<div><span class="p">꽃집</span> 알아보기</div><br>
<!-- 지도 api -->
	<div id="map" style="width:100%;height:350px;"></div>
		<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=2938f43df9209b84272d11be417f045a"></script>
		<script>
		var mapContainer = document.getElementById('map');
		var mapOptions = {
			center: new kakao.maps.LatLng(37.63948, 127.10985),
			level: 6
		};
		
		//지도 생성
		var map = new kakao.maps.Map(mapContainer, mapOptions);
		
		// 마커가 표시될 위치
		//var markerPosition  = new kakao.maps.LatLng(37.64287, 127.10526); //그린샵
		//var markerPosition2  = new kakao.maps.LatLng(37.63948, 127.10985); //청운꽃방
		var positions = [
			    {
			    	content: '<div style="padding:5px;"><center>그린샵</center><a href="https://map.kakao.com/link/map/그린샵, 37.64287, 127.10526" style="color:blue" target="_blank">큰지도보기</a> <a href="https://map.kakao.com/link/to/그린샵, 37.64287, 127.10526" style="color:blue" target="_blank">길찾기</a></div>', 
			        latlng: new kakao.maps.LatLng(37.64287, 127.10526)
			    },
			    {
			        content: '<div style="padding:5px;"><center>청운꽃방</center><a href="https://map.kakao.com/link/map/청운꽃방, 37.63948, 127.10985" style="color:blue" target="_blank">큰지도보기</a> <a href="https://map.kakao.com/link/to/청운꽃방, 37.63948, 127.10985" style="color:blue" target="_blank">길찾기</a></div>', 
			        latlng: new kakao.maps.LatLng(37.63948, 127.10985)
			    },
			    {
			        content: '<div style="padding:5px;"><center>라온플라워앤가든</center><a href="https://map.kakao.com/link/map/라온플라워앤가든, 37.63362, 127.11958" style="color:blue" target="_blank">큰지도보기</a> <a href="https://map.kakao.com/link/to/라온플라워앤가든, 37.63362, 127.11958" style="color:blue" target="_blank">길찾기</a></div>', 
			        latlng: new kakao.maps.LatLng(37.63362, 127.11958)
			    },
			    {
			        content: '<div style="padding:5px;"><center>파란마을</center><a href="https://map.kakao.com/link/map/파란마을,37.64171, 127.12131" style="color:blue" target="_blank">큰지도보기</a> <a href="https://map.kakao.com/link/to/파란마을, 37.64171, 127.12131" style="color:blue" target="_blank">길찾기</a></div>', 
			        latlng: new kakao.maps.LatLng(37.64171, 127.12131)
			    }
			    /*,{
			        content: '<div style="padding:5px;"><center>오직꽃</center><a href="https://map.kakao.com/link/map/오직꽃,37.63231, 127.11550" style="color:blue" target="_blank">큰지도보기</a> <a href="https://map.kakao.com/link/to/오직꽃, 37.63231, 127.11550" style="color:blue" target="_blank">길찾기</a></div>', 
			        latlng: new kakao.maps.LatLng(37.63231, 127.11550)
			    }*/
	    ];
		
		// 여러마커를 생성 + 여러 인포윈도우 생성
		for(var i=0; i<positions.length; i++) {
			
				var marker = new kakao.maps.Marker({
					map: map, // 마커를 표시할 지도
			        position: positions[i].latlng // 마커를 표시할 위치
				});
				marker.setMap(map);
				
				// 마커에 표시할 인포윈도우를 생성합니다 
			    var infowindow = new kakao.maps.InfoWindow({
			        content: positions[i].content // 인포윈도우에 표시할 내용
			    });
			    infowindow.open(map, marker); 
			    
			    //마우스 이벤트
			    //kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
			    //kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
				
		}
		/*
		// 인포윈도우를 표시하는 클로저를 만드는 함수입니다 
		function makeOverListener(map, marker, infowindow) {
		    return function() {
		        infowindow.open(map, marker);
		    };
		}

		// 인포윈도우를 닫는 클로저를 만드는 함수입니다 
		function makeOutListener(infowindow) {
		    return function() {
		        infowindow.close();
		    };
		}*/
		
		//일일히 마커 생성 TEST
		/*var marker = new kakao.maps.Marker({
		    position: markerPosition
		});
		var marker2 = new kakao.maps.Marker({
		    position: markerPosition2
		});*/ 
		
		/*for(var t=0; t<iwpositions.length; t++){
			var infowindow = new kakao.maps.InfoWindow({
					map: map,
				    position : iwpositions[t].iwPosition, 
				    content : iwContent[t] 
			});
		}*/
		
		// 마커가 지도 위에 표시되도록 설정
		 //marker.setMap(map);
		 //marker2.setMap(map);
		
		// 인포윈도우에 표출될 내용으로 HTML 문자열이나 document element가 가능.
		// var iwContent = '<div style="padding:5px;"><center>그린샵</center><a href="https://map.kakao.com/link/map/그린다 플라워, 37.64287, 127.10526" style="color:blue" target="_blank">큰지도보기</a> <a href="https://map.kakao.com/link/to/그린다 플라워, 37.64287, 127.10526" style="color:blue" target="_blank">길찾기</a></div>',
	   //인포윈도우 표시 위치
	 	//	iwPosition = new kakao.maps.LatLng(37.64287, 127.10526); 
	
		// 인포윈도우를 생성
		/*var infowindow = new kakao.maps.InfoWindow({
		    position : iwPosition, 
		    content : iwContent 
		});*/
		  
		// 마커 위에 인포윈도우를 표시. 두번째 파라미터인 marker를 넣어주지 않으면 지도 위에 표시됨.
		//infowindow.open(map, marker); 	
	</script>
	<hr>
	<div><span class="p">꽃</span> 예약하기</div><br>
	<div style="color:darkgray"> > 꽃다발 예약</div>
    <div class="drop">
    	<div class="button"> > 오늘의 꽃 보기
            <table class="hide">
                <tr>
				<td style="text-align:center">
				<img src="C:\Users\hello\eclipse-workspace\Fiore\WebContent\image\spring1" onclick=""> <br/> 벚꽃
				</td>
				<td style="text-align:center">
				<img src="C:\Users\hello\eclipse-workspace\Fiore\WebContent\image\spring2" onclick=""> <br/> 유채꽃
				</td>
				</tr>
				<tr>
				<td style="text-align:center">
				<img src="C:\Users\hello\eclipse-workspace\Fiore\WebContent\image\spring3" onclick=""> <br/> 튤립
				</td>
				<td style="text-align:center">
				<img src="C:\Users\hello\eclipse-workspace\Fiore\WebContent\image\spring4" onclick=""> <br/> 매화
				</td>
				</tr>
            </table>
	</div>
	<div class="button" onclick=""> > 예약하기 </div>
	<!-- 후기 버튼 누르면 후기 쫘르륵 나오는데 그 밑에 다른 판매자 리스트 같은거 넣으면 계속 스크롤 해야하고 
		 후기 작성하는것도 버튼이 맨위에 오거나 아니면 아예 따로 후기 페이지를 빼야할 거 같아요 -->
 	<div class="button" onclick="comment()" style="color:darkgray"> > 후기</div>
 	<table id="list"></table>
 	<!-- 판매자 리스트 부분 어디다가 넣어야할 지 몰라서 여기다가 넣었어요 -->
 	<div class="button" onclick="showseller()" style="color: red">판매자 리스트</div>
 	<table id="list2" border="1"></table>
	</div>
	</div>
</body>
</html>
<script src="js/jquery-3.6.0.min.js"></script>
<script src="js/core.js"></script>
<script>
   $(document).ready(function(){
        $(".drop>table").click(function(){
            $(this).next("table").toggleClass("hide");
        });
    });
   
   $(document).ready(function(){
		Page.init();
	});

	var minNo = -1;
	var hide = -1;
	function comment(){
		if (hide == -1){
			var str = "<div class='button' style='width:50%; line-height:20px' onclick='uploadtable()';>후기작성</div><br><div id='commentAdd'></div>";
			$("#list").html(str);
			AJAX.call("jsp/getGroupComment.jsp", null, function(data){
				var feeds = JSON.parse(data.trim()); // 스트링을 객체 형태로 바꿈, 배열이 된다.
				if(feeds.length > 0){
					minNo = feeds[feeds.length - 1].no;
				}
				show(feeds); 
			});
			hide = 0;
		}else{
			$("#list").html("");
			hide = -1;
		}
	}
	
	var showfeeds;
	function show(feeds){
		showfeeds = -1;
		var str = "";
		for(var i=0; i<feeds.length; i++){
			var img = feeds[i].images, imgstr = "";
			if(img != null){
				imgstr = "<img src='images/" + img + "'width=100%>";
			}
			str += "<tr><td colspan=3><hr></td></tr>";
			str += "<tr>";
			str += "<td>" + feeds[i].id + "</td>";
			str += "<td>" + feeds[i].title + "</td>";
			str += "<td><small>(" + feeds[i].ts + ")</small></td>";
			str += "</tr>";
			str += "<tr><td colspan=3>" + imgstr + "</td></tr>";
			str += "<tr><td colspan=3>" + feeds[i].content + "</td></tr>";
		}
		$("#list").append(str); // <table id="list">에 들어가게 됨
	}

	function getNext(){
		var params = {maxNo: minNo};
		AJAX.call("jsp/GetGroupComment.jsp", params, function(data){
			var feeds = JSON.parse(data.trim());
			if (feeds.length > 0){ 
				minNo = feeds[feeds.length - 1].no;
			}else{
				alert("더이상 작성글이 없습니다.");
			}
			show(feeds);
		});
	}
	
	hide2 = -1;
	function uploadtable(){
		if(hide2 == -1){
			var str = "";
			str += "<div style='text-align:center;'>"
			str += "<input type='text' id='id' placeholder='아이디 (이메일주소)'>"
			str += "<input type='text' id='title' name='title' placeholder='제목을 입력해주세요'>"
			str += "<textarea id='content' placeholder='내용을 입력해주세요.' rows='15' cols='30'></textarea>"
			str += "<div style='color: gray'><small>이미지를 넣어주세요</small></div>"
			str += "<input type='file' id='image'>"
			str += "<br>"
			str += "<input type='submit' value='업로드하기' onclick='upload()'>"
			str += "</div>"
			$("#commentAdd").html(str);
			hide2 = 0;
		}else{
			$("#commentAdd").html("");
			hide2 = -1;
		}
	}
	
	/* 업로드 관련 */
	function upload(){
	var id = $("#id").val().trim();
	if(id == ""){
		alert("아이디를 입력해 주세요");
		$("#id").focus();
		return;
	}
	
	var title = $("#title").val().trim();
	if(title == ""){
		alert("제목을 입력해주세요");
		$("#title").focus();
		return;
	}
	
	var content = $("#content").val().trim();
	if(content == ""){
		alert("작성글을 입력해주세요");
		$("#content").focus();
		return;
	}
	
	var imgobj = $("#image")[0].files[0];
	var jsonobj = {id: id, title: title, content: content, ts: getTime()};
	if(imgobj != null){
		jsonobj.images = [imgobj.name];
	}
	
	var params = new FormData();
	params.append("jsonstr", JSON.stringify(jsonobj));
	if(imgobj != null){
		params.append("image", imgobj);
	}
	
	var url = "jsp/reservaionCommentAdd.jsp";
	AJAX.call(url, params, function(data){
		var code = data.trim();
		if (code == "ER") {
			alert("작성 글의 업로드 중 오류가 발생하였습니다.");
		}
		else{
			alert("작성 글의 업로드가 완료되었습니다.");
			window.location.href = "onedayclass.html";
		}
	}, true);
	}
	
	function getToday(){
	var date = new Date();
	var year = date.getFullYear();
	var month = ("0" + (1 + date.getMonth())).slice(-2);
	var day = ("0" + date.getDate()).slice(-2);
	return year + "-" + month + "-" + day;
	}
	
	function getTime(){
	var date = new Date();
	var year = date.getFullYear();
	var month = ("0" + (1 + date.getMonth())).slice(-2);
	var day = ("0" + date.getDate()).slice(-2);
	
	var hour = ("0" + date.getHours()).slice(-2);
	var min = ("0" + date.getMinutes()).slice(-2);
	var sec = ("0" + date.getSeconds()).slice(-2);
	
	return year + "-" + month + "-" + day + " " + hour + ":" + min + ":" + sec;
	}
	
	
	hide3 = -1;
	function showseller(){
			if(hide3 == -1){
			var users;
			AJAX.call("jsp/sellerList.jsp", null, function(data){
				users = JSON.parse(data.trim());
				showseller2(users);// 스트링을 객체 형태로 바꿈, 배열이 된다.
			});
			hide3 = 0;
		}else{
			$("#list2").html("");
			hide3 = -1;
		}
	}
	
	// 판매자 리스트
	function showseller2(users){
		var str = "";
		str += "<tr><td colspan='7' style='text-align:center'>판매자 리스트</td>";
		str += "<tr>";
		str += "<td>선택</td>";
		str += "<td>가게번호</td>"
		str += "<td>가게이름</td>";
		str += "<td>가게주소</td>";
		str += "<td>구분</td>";
		str += "<td>아이디</td>"
		str += "<td>휴대폰 번호</td>";
		str += "</tr>";
		for(var i=0; i<users.length; i++){
			str += "<tr>";
			str += "<td><input type='radio' id='no' value='" + users[i].no + "'></td>"; 
			str += "<td>" + users[i].no + "</td>";
			str += "<td>" + users[i].storename + "</td>";
			str += "<td>" + users[i].storeaddress + "</td>";
			str += "<td>" + users[i].userclass + "</td>";
			str += "<td>" + users[i].id + "</td>";
			str += "<td>" + users[i].phonenum + "</td>";
			str += "</tr>";
		}
		$("#list2").html(str);
	}

</script>